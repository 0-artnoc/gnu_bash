*** /fs2/chet/scratch/bash-4.2-direxpand/bashline.c	2011-11-23 17:11:31.000000000 -0500
--- bashline.c	2011-11-05 18:46:35.000000000 -0400
***************
*** 1292,1295 ****
--- 1339,1343 ----
  
    rl_filename_quote_characters = default_filename_quote_characters;
+   set_directory_hook ();
  
    /* Determine if this could be a command word.  It is if it appears at
***************
*** 1605,1608 ****
--- 1672,1681 ----
  	  else
  	    {
+ 	     if (dircomplete_expand && path_dot_or_dotdot (filename_hint))
+ 		{
+ 		  dircomplete_expand = 0;
+ 		  set_directory_hook ();
+ 		  dircomplete_expand = 1;
+ 		}
  	      mapping_over = 4;
  	      goto inner;
***************
*** 1805,1808 ****
--- 1878,1884 ----
   inner:
    val = rl_filename_completion_function (filename_hint, istate);
+   if (mapping_over == 4 && dircomplete_expand)
+     set_directory_hook ();
+ 
    istate = 1;
  
