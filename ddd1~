*** ../bash-4.0-patched/lib/readline/display.c	2009-01-04 14:32:32.000000000 -0500
--- lib/readline/display.c	2009-04-25 21:42:18.000000000 -0400
***************
*** 513,516 ****
--- 513,517 ----
       data structures. */
    _rl_block_sigint ();  
+   RL_SETSTATE (RL_STATE_REDISPLAYING);
  
    if (!rl_display_prompt)
***************
*** 1237,1240 ****
--- 1238,1242 ----
    }
  
+   RL_UNSETSTATE (RL_STATE_REDISPLAYING);
    _rl_release_sigint ();
  }
***************
*** 1773,1777 ****
  	     adjust col_lendiff based on the difference between _rl_last_c_pos
  	     and _rl_screenwidth */
! 	  if (col_lendiff && (_rl_last_c_pos < _rl_screenwidth))
  #endif
  	    {	  
--- 1775,1779 ----
  	     adjust col_lendiff based on the difference between _rl_last_c_pos
  	     and _rl_screenwidth */
! 	  if (col_lendiff && ((MB_CUR_MAX == 1 || rl_byte_oriented) || (_rl_last_c_pos < _rl_screenwidth)))
  #endif
  	    {	  
***************
*** 1893,1896 ****
--- 1895,1902 ----
    woff = WRAP_OFFSET (_rl_last_v_pos, wrap_offset);
    cpos = _rl_last_c_pos;
+ 
+   if (cpos == 0 && cpos == new)
+     return;
+ 
  #if defined (HANDLE_MULTIBYTE)
    /* If we have multibyte characters, NEW is indexed by the buffer point in
***************
*** 1906,1912 ****
  	 desired display position. */
        if ((new > prompt_last_invisible) ||		/* XXX - don't use woff here */
! 	  (prompt_physical_chars > _rl_screenwidth &&
  	   _rl_last_v_pos == prompt_last_screen_line &&
! 	   wrap_offset >= woff &&
  	   new > (prompt_last_invisible-(_rl_screenwidth*_rl_last_v_pos)-wrap_offset)))
  	   /* XXX last comparison might need to be >= */
--- 1912,1918 ----
  	 desired display position. */
        if ((new > prompt_last_invisible) ||		/* XXX - don't use woff here */
! 	  (prompt_physical_chars >= _rl_screenwidth &&
  	   _rl_last_v_pos == prompt_last_screen_line &&
! 	   wrap_offset >= woff && dpos >= woff &&
  	   new > (prompt_last_invisible-(_rl_screenwidth*_rl_last_v_pos)-wrap_offset)))
  	   /* XXX last comparison might need to be >= */
